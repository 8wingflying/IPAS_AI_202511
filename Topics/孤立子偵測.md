## 孤立子|離群值偵測 Outlier Detection 

```python
# =======================================
# 📘 離群值偵測 Outlier Detection 實作示範
# =======================================

import numpy as np
import pandas as pd
from sklearn.ensemble import IsolationForest
from sklearn.neighbors import LocalOutlierFactor
from scipy import stats
import matplotlib.pyplot as plt
import seaborn as sns

# 建立範例資料（包含離群點）
np.random.seed(42)
normal_data = np.random.normal(50, 5, 100)
outliers = np.array([20, 120, 150])  # 明顯異常值
data = np.concatenate([normal_data, outliers])
df = pd.DataFrame({'value': data})

# ==========================
# 1️⃣ Z-score 離群值偵測
# ==========================
df['z_score'] = stats.zscore(df['value'])
df['z_outlier'] = np.where(np.abs(df['z_score']) > 3, 1, 0)

print("Z-score 偵測結果：")
print(df[df['z_outlier'] == 1])

# ==========================
# 2️⃣ IQR 離群值偵測
# ==========================
Q1 = df['value'].quantile(0.25)
Q3 = df['value'].quantile(0.75)
IQR = Q3 - Q1
lower, upper = Q1 - 1.5*IQR, Q3 + 1.5*IQR

df['iqr_outlier'] = np.where((df['value'] < lower) | (df['value'] > upper), 1, 0)
print("\nIQR 偵測結果：")
print(df[df['iqr_outlier'] == 1])

# ==========================
# 3️⃣ Isolation Forest
# ==========================
iso = IsolationForest(contamination=0.03, random_state=42)
df['iso_outlier'] = iso.fit_predict(df[['value']])
df['iso_outlier'] = df['iso_outlier'].map({1:0, -1:1})

print("\nIsolation Forest 偵測結果：")
print(df[df['iso_outlier'] == 1])

# ==========================
# 4️⃣ Local Outlier Factor (LOF)
# ==========================
lof = LocalOutlierFactor(n_neighbors=20, contamination=0.03)
df['lof_outlier'] = lof.fit_predict(df[['value']])
df['lof_outlier'] = df['lof_outlier'].map({1:0, -1:1})

print("\nLOF 偵測結果：")
print(df[df['lof_outlier'] == 1])

# ==========================
# 5️⃣ 視覺化 Boxplot
# ==========================
plt.figure(figsize=(8,4))
sns.boxplot(df['value'])
plt.title("Boxplot 離群值視覺化")
plt.show()

```
