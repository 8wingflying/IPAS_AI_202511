##

## è³‡æ–™é›†
- [Outlier Detection DataSets](https://shebuti.com/outlier-detection-datasets-odds/)
- [ADBenchmarks: Real-world anomaly detection datasets](https://github.com/mala-lab/ADBenchmarks-anomaly-detection-datasets)
- [Evaluation of Datasets for Outlier Detection](https://www.researchgate.net/publication/384334491_Evaluation_of_Datasets_for_Outlier_Detection)

## å­¤ç«‹å­|é›¢ç¾¤å€¼åµæ¸¬ Outlier Detection 

```python
# =======================================
# ğŸ“˜ é›¢ç¾¤å€¼åµæ¸¬ Outlier Detection å¯¦ä½œç¤ºç¯„
# =======================================

import numpy as np
import pandas as pd
from sklearn.ensemble import IsolationForest
from sklearn.neighbors import LocalOutlierFactor
from scipy import stats
import matplotlib.pyplot as plt
import seaborn as sns

# å»ºç«‹ç¯„ä¾‹è³‡æ–™ï¼ˆåŒ…å«é›¢ç¾¤é»ï¼‰
np.random.seed(42)
normal_data = np.random.normal(50, 5, 100)
outliers = np.array([20, 120, 150])  # æ˜é¡¯ç•°å¸¸å€¼
data = np.concatenate([normal_data, outliers])
df = pd.DataFrame({'value': data})

# ==========================
# 1ï¸âƒ£ Z-score é›¢ç¾¤å€¼åµæ¸¬
# ==========================
df['z_score'] = stats.zscore(df['value'])
df['z_outlier'] = np.where(np.abs(df['z_score']) > 3, 1, 0)

print("Z-score åµæ¸¬çµæœï¼š")
print(df[df['z_outlier'] == 1])

# ==========================
# 2ï¸âƒ£ IQR é›¢ç¾¤å€¼åµæ¸¬
# ==========================
Q1 = df['value'].quantile(0.25)
Q3 = df['value'].quantile(0.75)
IQR = Q3 - Q1
lower, upper = Q1 - 1.5*IQR, Q3 + 1.5*IQR

df['iqr_outlier'] = np.where((df['value'] < lower) | (df['value'] > upper), 1, 0)
print("\nIQR åµæ¸¬çµæœï¼š")
print(df[df['iqr_outlier'] == 1])

# ==========================
# 3ï¸âƒ£ Isolation Forest
# ==========================
iso = IsolationForest(contamination=0.03, random_state=42)
df['iso_outlier'] = iso.fit_predict(df[['value']])
df['iso_outlier'] = df['iso_outlier'].map({1:0, -1:1})

print("\nIsolation Forest åµæ¸¬çµæœï¼š")
print(df[df['iso_outlier'] == 1])

# ==========================
# 4ï¸âƒ£ Local Outlier Factor (LOF)
# ==========================
lof = LocalOutlierFactor(n_neighbors=20, contamination=0.03)
df['lof_outlier'] = lof.fit_predict(df[['value']])
df['lof_outlier'] = df['lof_outlier'].map({1:0, -1:1})

print("\nLOF åµæ¸¬çµæœï¼š")
print(df[df['lof_outlier'] == 1])

# ==========================
# 5ï¸âƒ£ è¦–è¦ºåŒ– Boxplot
# ==========================
plt.figure(figsize=(8,4))
sns.boxplot(df['value'])
plt.title("Boxplot é›¢ç¾¤å€¼è¦–è¦ºåŒ–")
plt.show()

```
## KNN é›¢ç¾¤å€¼åµæ¸¬(ä½¿ç”¨pyodå¥—ä»¶)
```python
# ============================
# ğŸ“˜ KNN é›¢ç¾¤å€¼åµæ¸¬ç¯„ä¾‹
# ============================
import numpy as np
import matplotlib.pyplot as plt
from pyod.models.knn import KNN  # pip install pyod

# å»ºç«‹è³‡æ–™é›†
X_inliers = 0.3 * np.random.randn(100, 2)
X_outliers = np.random.uniform(low=-4, high=4, size=(5, 2))
X = np.r_[X_inliers + 2, X_inliers - 2, X_outliers]

# å»ºç«‹ KNN æ¨¡å‹
knn = KNN(contamination=0.05)  # å‡è¨­é›¢ç¾¤å€¼æ¯”ä¾‹ 5%
knn.fit(X)

# é æ¸¬
y_pred = knn.labels_            # 0 = æ­£å¸¸, 1 = é›¢ç¾¤
y_scores = knn.decision_scores_ # é›¢ç¾¤åˆ†æ•¸

# è¦–è¦ºåŒ–çµæœ
plt.figure(figsize=(6,6))
plt.scatter(X[:,0], X[:,1], c=y_pred, cmap='coolwarm', s=50)
plt.title("KNN Outlier Detection Example")
plt.xlabel("Feature 1")
plt.ylabel("Feature 2")
plt.show()

```
## KNN é›¢ç¾¤å€¼åµæ¸¬(ä½¿ç”¨Scikit-learn)
- 
```python
from sklearn.neighbors import LocalOutlierFactor

lof = LocalOutlierFactor(n_neighbors=5, contamination=0.05)
y_pred = lof.fit_predict(X)

plt.figure(figsize=(6,6))
plt.scatter(X[:,0], X[:,1], c=y_pred, cmap='coolwarm', s=50)
plt.title("Local Outlier Factor (åŸºæ–¼KNNçš„é›¢ç¾¤åµæ¸¬)")
plt.show()
```
## Credit Card Fraud Detection
- ğŸ¯ ç›®æ¨™ï¼šä½¿ç”¨ Isolation Forest èˆ‡ LOF åµæ¸¬è©æ¬ºäº¤æ˜“
```python

# =======================================
# Kaggle: Credit Card Fraud Detection
# =======================================

import pandas as pd
import numpy as np
from sklearn.preprocessing import StandardScaler
from sklearn.ensemble import IsolationForest
from sklearn.neighbors import LocalOutlierFactor
from sklearn.metrics import classification_report, confusion_matrix

# 1ï¸âƒ£ è®€å–è³‡æ–™
df = pd.read_csv("creditcard.csv")

# 2ï¸âƒ£ å‰è™•ç†
features = df.drop(columns=["Class"])
labels = df["Class"]  # 0=æ­£å¸¸, 1=è©æ¬º
scaler = StandardScaler()
X = scaler.fit_transform(features)

# 3ï¸âƒ£ ä½¿ç”¨ Isolation Forest
iso = IsolationForest(contamination=0.0017, random_state=42)
y_pred_iso = iso.fit_predict(X)
y_pred_iso = np.where(y_pred_iso == -1, 1, 0)  # 1ä»£è¡¨ç•°å¸¸

print("ğŸ”¹ Isolation Forest çµæœ")
print(confusion_matrix(labels, y_pred_iso))
print(classification_report(labels, y_pred_iso))

# 4ï¸âƒ£ ä½¿ç”¨ LOF
lof = LocalOutlierFactor(n_neighbors=20, contamination=0.0017)
y_pred_lof = lof.fit_predict(X)
y_pred_lof = np.where(y_pred_lof == -1, 1, 0)

print("\nğŸ”¹ Local Outlier Factor çµæœ")
print(confusion_matrix(labels, y_pred_lof))
print(classification_report(labels, y_pred_lof))

```


## Paysim æ¨¡æ“¬é‡‘èç•°å¸¸äº¤æ˜“
- ğŸ¯ ç›®æ¨™ï¼šåˆ©ç”¨ KNN èˆ‡ IQR åµæ¸¬æ¨¡æ“¬é‡‘èäº¤æ˜“ç•°å¸¸
```python
# =======================================
# Kaggle: Paysim æ¨¡æ“¬é‡‘èäº¤æ˜“è³‡æ–™
# =======================================
import pandas as pd
from pyod.models.knn import KNN
from sklearn.preprocessing import MinMaxScaler

# 1ï¸âƒ£ è®€å…¥è³‡æ–™
data = pd.read_csv("PS_20174392719_1491204439457_log.csv")
df = data.sample(50000)  # æŠ½æ¨£ä»¥åŠ å¿«é‹ç®—

# 2ï¸âƒ£ é¸æ“‡éƒ¨åˆ†æ•¸å€¼ç‰¹å¾µ
X = df[['amount', 'oldbalanceOrg', 'newbalanceOrig']]
X_scaled = MinMaxScaler().fit_transform(X)

# 3ï¸âƒ£ å»ºç«‹ KNN æ¨¡å‹
knn = KNN(contamination=0.01)
knn.fit(X_scaled)
df['outlier'] = knn.labels_

# 4ï¸âƒ£ çµæœæª¢è¦–
print(df['outlier'].value_counts())
print(df[df['outlier'] == 1].head())

# 5ï¸âƒ£ è¦–è¦ºåŒ–
import matplotlib.pyplot as plt
plt.scatter(df['oldbalanceOrg'], df['amount'], c=df['outlier'], cmap='coolwarm', s=5)
plt.xlabel("Old Balance")
plt.ylabel("Amount")
plt.title("KNN Outlier Detection - Paysim")
plt.show()
```
## Data Cleaning Challenge: Outliers
- ğŸ¯ ç›®æ¨™ï¼šä½¿ç”¨ IQR æ³• + Boxplot æ‰¾å‡ºå ±éŠ·è³‡æ–™ä¸­çš„é›¢ç¾¤é»
```python
# =======================================
# Kaggle: Data Cleaning Challenge - Outliers
# =======================================
import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt

# 1ï¸âƒ£ è¼‰å…¥è³‡æ–™
df = pd.read_csv("brasilian_public_expenses.csv")  # Kaggle Notebook ç¯„ä¾‹è³‡æ–™
print(df.describe())

# 2ï¸âƒ£ IQR è¨ˆç®—
Q1 = df['reimbursement_value'].quantile(0.25)
Q3 = df['reimbursement_value'].quantile(0.75)
IQR = Q3 - Q1
upper = Q3 + 1.5 * IQR

# 3ï¸âƒ£ æ‰¾å‡ºé›¢ç¾¤å€¼
outliers = df[df['reimbursement_value'] > upper]
print(f"é›¢ç¾¤æ¨£æœ¬æ•¸ï¼š{len(outliers)}")

# 4ï¸âƒ£ Boxplot è¦–è¦ºåŒ–
plt.figure(figsize=(8,4))
sns.boxplot(x=df['reimbursement_value'])
plt.title("Outlier Detection by IQR (Reimbursement Value)")
plt.show()
```
